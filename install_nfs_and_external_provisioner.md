# Настройка машины для NFS

Для при установке системы необходимо задать статический ip, дабы, чтобы клиент для nfs в kubernetes не потерял сервер nfs после рестарта,
ибо dhcp может выделить другой адрес.
Также необходимо открыть порты для nfs, если используется брандмауэр.

```bash

sudo ufw allow 2049
sudo ufw allow 111

```

Установим все необходимые утилиты для работы

```bash

sudo apt install nfs-kernel-server mc net-tools

```

Проверим порты

```bash

rpcinfo -p | grep nfs

100003    3   tcp   2049  nfs
100003    4   tcp   2049  nfs


```

Также важно проверить поддерживается ли NFS на уровне ядра:

```bash

cat /proc/filesystems | grep nfs
 
Видим, что работает, но если нет, нужно вручную загрузить модуль ядра nfs

вывод: nodev	nfsd

Для загрузки в ядро

modprobe nfs

```

Ставим сервис на автозагрузку

```bash

sudo systemctl enable nfs-server

```

Создаем каталог для хранения 

```bash

mkdir -p /var/nfs/monolith

```

Важно создаем пользователя и присваиваем ему uid 1001,ак как кластер разворачивался не через root, то при создании pvc для хранения будет отказано в доступе




